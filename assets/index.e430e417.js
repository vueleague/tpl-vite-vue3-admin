var x=Object.defineProperty,V=Object.defineProperties;var q=Object.getOwnPropertyDescriptors;var v=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,M=Object.prototype.propertyIsEnumerable;var $=(e,o,a)=>o in e?x(e,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[o]=a,B=(e,o)=>{for(var a in o||(o={}))N.call(o,a)&&$(e,a,o[a]);if(v)for(var a of v(o))M.call(o,a)&&$(e,a,o[a]);return e},w=(e,o)=>V(e,q(o));var c=(e,o,a)=>new Promise((T,r)=>{var E=i=>{try{h(a.next(i))}catch(b){r(b)}},_=i=>{try{h(a.throw(i))}catch(b){r(b)}},h=i=>i.done?T(i.value):Promise.resolve(i.value).then(E,_);h((a=a.apply(e,o)).next())});import{D as l,b_ as O,bo as R,b as z,C as G,o as k,e as J,E as u,Q as n,bZ as F,h as d,t as C,G as I,aJ as L,f as Q,I as U,bC as g,a7 as D,b$ as W,c0 as X,be as Z}from"./vendor.0b1d9c36.js";/* empty css               */import{u as j}from"./dynamic-table.bceae78c.js";/* empty css               */import{i as p,X as m}from"./index.ba2a0c35.js";import{u as H}from"./useFormModal.c00c4eeb.js";import"./schema-form.a98a8267.js";import"./index.f26c1058.js";const K=e=>{switch(e){case 0:return"#d9d9d9";case 1:return"#52c41a"}},Y=e=>{switch(e){case 0:return"\u505C\u6B62";case 1:return"\u8FD0\u884C"}},ee=[{title:"\u4EFB\u52A1\u540D\u79F0",dataIndex:"name",width:240},{title:"\u72B6\u6001",width:120,dataIndex:"status",align:"center",bodyCell:({record:e})=>l(O,{status:e.status===1?"processing":"default",color:K(e.status),text:Y(e.status)},null)},{title:"\u7C7B\u578B",width:100,align:"center",dataIndex:"type",bodyCell:({record:e})=>l(R,{color:"processing"},{default:()=>[e.type===1?"Interval":"Cron"]})},{title:"\u8C03\u7528\u670D\u52A1",dataIndex:"service",hideInSearch:!0,align:"center",width:350},{title:"\u6267\u884C\u53C2\u6570",dataIndex:"data",align:"center",hideInSearch:!0,width:450},{title:"\u5907\u6CE8",width:250,align:"center",dataIndex:"remark"}],te=[{field:"type",component:"RadioGroup",label:"\u540D\u79F0",defaultValue:0,rules:[{required:!0,type:"number"}],componentProps:{options:[{label:"Cron",value:0},{label:"\u65F6\u95F4\u95F4\u9694",value:1}]}},{field:"name",component:"Input",label:"\u4EFB\u52A1\u540D\u79F0",rules:[{required:!0,type:"string"}]},{field:"service",component:"Input",label:"\u670D\u52A1\u8DEF\u5F84",rules:[{required:!0,type:"string"}],componentProps:{placeholder:"\u8BF7\u8F93\u5165\u8C03\u7528\u670D\u52A1\u7684\u8DEF\u5F84"}},{field:"data",component:"Input",label:"\u4EFB\u52A1\u53C2\u6570",componentProps:{placeholder:"\u8BF7\u8F93\u5165\u4EFB\u52A1\u53C2\u6570\uFF08\u53EF\u4E0D\u586B\uFF09"}},{field:"limit",component:"InputNumber",label:"\u6267\u884C\u6B21\u6570",defaultValue:-1,componentProps:{min:-1,style:{width:"100%"}}},{field:"cron",component:"Input",label:"Cron",rules:[{required:!0,type:"string"}],vIf:({formModel:e})=>e.type===0,componentProps:{placeholder:"\u8BF7\u8F93\u5165Cron\u8868\u8FBE\u5F0F"}},{field:"every",component:"InputNumber",label:"\u6267\u884C\u95F4\u9694",defaultValue:6e4,vIf:({formModel:e})=>e.type===1,rules:[{required:!0,type:"number"}],componentProps:{min:100,style:{width:"100%"}}},{field:"startTime",component:"DatePicker",label:"\u5F00\u59CB\u65F6\u95F4",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"endTime",component:"DatePicker",label:"\u7ED3\u675F\u65F6\u95F4",vIf:({formModel:e})=>e.type===0,componentProps:{showTime:!0,style:{width:"100%"}}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"status",component:"RadioGroup",defaultValue:1,label:"\u72B6\u6001",componentProps:{options:[{label:"\u8FD0\u884C",value:1},{label:"\u505C\u6B62",value:0}]}}];function ue(e){return p({url:m.page,method:"get",params:e})}function ae(e){return p({url:m.info,method:"get",params:e})}function se(e){return p({url:m.add,method:"post",data:e},{successMsg:"\u6DFB\u52A0\u6210\u529F"})}function ne(e){return p({url:m.delete,method:"post",data:e})}function le(e){return p({url:m.update,method:"post",data:e},{successMsg:"\u4FEE\u6539\u6210\u529F"})}function oe(e){return p({url:m.once,method:"post",data:e})}function ie(e){return p({url:m.start,method:"post",data:e})}function de(e){return p({url:m.stop,method:"post",data:e})}const re=d(" \u65B0\u589E "),pe=d("\u79D2 \u5206 \u5C0F\u65F6 \u65E5\u671F \u6708\u4EFD \u661F\u671F \u5E74(\u53EF\u9009)"),me=d("\u4EC5\u4E00\u6B21 "),ce=d("\u8FD0\u884C "),Fe=d("\u505C\u6B62 "),fe={name:"SystemScheduleTask"},we=z(w(B({},fe),{setup(e){const[o,a]=j({search:!1,size:"small"}),[T]=H(),r=()=>a==null?void 0:a.reload(),E=t=>c(this,null,function*(){const[f]=yield T({modalProps:{title:`${t.id?"\u7F16\u8F91":"\u65B0\u589E"}\u4EFB\u52A1`,width:640,onFinish:y=>c(this,null,function*(){const s=w(B({},y),{id:t.id});yield(t.id?le:se)(s),r()})},formProps:{labelWidth:100,schemas:te}});if(t.id){const y=yield ae({id:t.id});f==null||f.setFieldsValue(B(B({},t),y))}}),_=t=>c(this,null,function*(){yield ne({id:t}),r()}),h=t=>c(this,null,function*(){yield oe({id:t.id}),r()}),i=t=>c(this,null,function*(){yield ie({id:t.id}),r()}),b=t=>c(this,null,function*(){yield de({id:t.id}),r()}),P=t=>!t.startTime&&!t.endTime?"\u65E0\u65F6\u6BB5\u9650\u5236":!t.startTime&&t.endTime?`\u65E0\u5F00\u59CB\u65F6\u95F4\u9650\u5236 - ${t.endTime}`:t.startTime&&!t.endTime?`${t.startTime} - \u957F\u671F\u6709\u6548`:`${t.startTime} - ${t.endTime}`,S=[...ee,{title:"\u64CD\u4F5C",width:220,dataIndex:"$action",align:"center",fixed:"right",actions:({record:t})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.task.update",effect:"disable"},onClick:()=>E(t)},{label:"\u5220\u9664",auth:"sys.task.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>_(t.id)}}]}];return(t,f)=>{const y=G("a-button");return k(),J("div",null,[l(n(o),{"row-key":"id","header-title":"\u5B9A\u65F6\u4EFB\u52A1","data-request":n(ue),columns:S,scroll:{x:2e3},bordered:""},{toolbar:u(()=>[l(y,{type:"primary",disabled:!t.$auth("sys.task.add"),onClick:f[0]||(f[0]=s=>E({}))},{default:u(()=>[re]),_:1},8,["disabled"])]),expandedRowRender:u(({record:s})=>[l(n(F),{column:1},{default:u(()=>[l(n(F).Item,{label:"\u4EFB\u52A1\u7F16\u53F7"},{default:u(()=>[d("# "+C(s.id),1)]),_:2},1024),l(n(F).Item,{label:"\u6267\u884C\u6B21\u6570"},{default:u(()=>[d(C(s.limit>0?`\u4EC5 ${s.limit} \u6B21`:"\u65E0\u6B21\u6570\u9650\u5236"),1)]),_:2},1024),s.type===1?(k(),I(n(F).Item,{key:0,label:"\u6267\u884C\u95F4\u9694"},{default:u(()=>[d(" \u6BCF"+C(s.every)+"\u6BEB\u79D2\u6267\u884C\u4E00\u6B21 ",1)]),_:2},1024)):(k(),I(n(F).Item,{key:1,label:"Cron\u8868\u8FBE\u5F0F"},{default:u(()=>[l(n(L),null,{title:u(()=>[pe]),default:u(()=>[d(" "+C(s.cron),1)]),_:2},1024)]),_:2},1024)),s.type===0?(k(),I(n(F).Item,{key:2,label:"\u6267\u884C\u65F6\u95F4\u6BB5"},{default:u(()=>[Q("span",null,C(P(s)),1)]),_:2},1024)):U("",!0),l(n(F).Item,{label:"\u6267\u884C\u64CD\u4F5C"},{default:u(()=>[l(n(g),{title:"\u786E\u8BA4\u624B\u52A8\u6267\u884C\u4E00\u6B21\u8BE5\u4EFB\u52A1\u5417?",disabled:!t.$auth("sys.task.once"),onConfirm:A=>h(s)},{default:u(()=>[l(n(D),{type:"link",size:"small",disabled:!t.$auth("sys.task.once")},{icon:u(()=>[l(n(W))]),default:u(()=>[me]),_:1},8,["disabled"])]),_:2},1032,["disabled","onConfirm"]),l(n(g),{title:"\u786E\u8BA4\u8FD0\u884C\u8BE5\u4EFB\u52A1\u5417?",disabled:!t.$auth("sys.task.start")||s.status!==0,onConfirm:A=>i(s)},{default:u(()=>[l(n(D),{type:"link",size:"small",disabled:!t.$auth("sys.task.start")||s.status!==0},{icon:u(()=>[l(n(X))]),default:u(()=>[ce]),_:2},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"]),l(n(g),{title:"\u786E\u8BA4\u505C\u6B62\u8BE5\u4EFB\u52A1\u5417?",disabled:!t.$auth("sys.task.stop")||s.status!==1,onConfirm:A=>b(s)},{default:u(()=>[l(n(D),{type:"link",size:"small",disabled:!t.$auth("sys.task.stop")||s.status!==1},{icon:u(()=>[l(n(Z))]),default:u(()=>[Fe]),_:2},1032,["disabled"])]),_:2},1032,["disabled","onConfirm"])]),_:2},1024)]),_:2},1024)]),_:1},8,["data-request"])])}}}));export{we as default};
