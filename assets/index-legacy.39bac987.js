!function(){var e=document.createElement("style");e.innerHTML=".split-wrapper{display:flex;width:100%;height:100%;background-color:#fff}.split-wrapper .scalable{position:relative;width:240px;max-width:50vw;min-width:100px;overflow:auto}.split-wrapper .scalable .left-content{height:100%;padding:12px 20px 12px 12px}.split-wrapper .scalable .separator{position:absolute;top:0;right:0;display:flex;width:14px;height:100%;cursor:col-resize;background-color:#fff;box-shadow:-4px -2px 4px -5px #00000059,4px 3px 4px -5px #00000059;align-items:center;justify-content:center}.split-wrapper .scalable .separator i{width:1px;height:14px;margin:0 1px;background-color:#e9e9e9}.split-wrapper .right-content{flex:1}.split-wrapper .left-content,.split-wrapper .right-content{overflow:auto}\n",document.head.appendChild(e),System.register(["./vendor-legacy.8528c51e.js","./index-legacy.f25f109a.js","./index-legacy.2b3aa6d8.js","./dynamic-table-legacy.2803c2bc.js","./index-legacy.da7add73.js","./useFormModal-legacy.a7b61c96.js","./utils-legacy.76523550.js","./schema-form-legacy.9d0dcf92.js","./index-legacy.9ee1e062.js"],(function(e){"use strict";var t,a,n,l,d,o,s,r,i,c,u,p,m,f,y,h,w,b,g,v,x,I,k,P,C,K,S,_,j,E,T,q,R,$,D,F,M,N,A,L,V,O,W,U,X,G;return{setters:[function(e){t=e.D,a=e.X,n=e.bo,l=e.aw,d=e.ap,o=e.b,s=e.j,r=e.au,i=e.o,c=e.e,u=e.f,p=e.a8,m=e.h,f=e.q,y=e.u,h=e.C,w=e.G,b=e.E,g=e.Q,v=e.aJ,x=e.bp,I=e.I,k=e.bq,P=e.aT,C=e.ac,K=e.br,S=e.bs,_=e.t,j=e.aC,E=e.a5,T=e.bt,q=e.bu,R=e.M,$=e.bv},function(){},function(e){D=e.g,F=e.u,M=e.c,N=e.t,A=e.d,L=e.a},function(e){V=e.u},function(e){O=e.i,W=e.s},function(e){U=e.u},function(e){X=e.f,G=e.a},function(){},function(){}],execute:function(){const z=[{field:"name",component:"Input",label:"部门名称",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"上级部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"排序号",defaultValue:255,componentProps:{style:{width:"100%"}}}],H=[{field:"departmentId",component:"TreeSelect",label:"所属部门",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"所属角色",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:async()=>(await D()).map((e=>({label:e.name,value:e.id})))}},{field:"username",component:"Input",label:"用户名",rules:[{required:!0}]},{field:"name",component:"Input",label:"姓名",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"呢称",colProps:{span:12}},{field:"email",component:"Input",label:"邮箱",colProps:{span:12}},{field:"phone",component:"Input",label:"手机",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"备注"},{field:"status",component:"RadioGroup",label:"状态",defaultValue:1,componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}}],J=[{field:"password",component:"Input",label:"新密码",rules:[{required:!0,type:"string"}]}],Q=[{field:"departmentId",component:"TreeSelect",label:"转移至",rules:[{required:!0,type:"number"}]}];function B(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!l(e)}const Y=[{title:"头像",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:e})=>t(a,{src:e.headImg},null)},{title:"姓名",width:120,dataIndex:"name",align:"center"},{title:"用户名",width:120,align:"center",dataIndex:"username"},{title:"所在部门",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"所属角色",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,customRender:({text:e})=>{let a;return t(d,null,B(a=e.map((e=>t(n,{color:"success",key:e},B(e)?e:{default:()=>[e]}))))?a:{default:()=>[a]})}},{title:"呢称",width:120,align:"center",dataIndex:"nickName"},{title:"邮箱",width:120,align:"center",dataIndex:"email"},{title:"手机",width:120,align:"center",dataIndex:"phone"},{title:"备注",width:120,align:"center",dataIndex:"remark"},{title:"状态",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"启用",value:1},{label:"禁用",value:0}]}},bodyCell:({record:e})=>{const a=1===e.status;return t(n,{color:a?"success":"red"},{default:()=>[a?"启用":"禁用"]})}},{title:"创建时间",dataIndex:"createdAt",width:120},{title:"修改时间",dataIndex:"updatedAt",width:120}];const Z={class:"split-wrapper"},ee={class:"left-content"},te=m(" 右边内容区 "),ae=[u("i",null,null,-1),u("i",null,null,-1)],ne={class:"right-content"},le=m(" 右边内容区 ");var de=o({setup(e){const t=s();let a,n;const l=r((function(e){t.value&&(t.value.style.width=n+e.clientX-a+"px")}),20),d=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",l),document.documentElement.removeEventListener("mouseup",d)},o=e=>{a=e.clientX,t.value&&(n=parseInt(window.getComputedStyle(t.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",l),document.documentElement.addEventListener("mouseup",d)};return(e,a)=>(i(),c("div",Z,[u("div",{ref_key:"scalable",ref:t,class:"scalable"},[u("div",ee,[p(e.$slots,"left-content",{},(()=>[te]))]),u("div",{ref:"separator",class:"separator",onMousedown:o},ae,544)],512),u("div",ne,[p(e.$slots,"right-content",{},(()=>[le]))])]))}});function oe(e){return O({url:W.add,method:"post",data:e},{successMsg:"创建用户成功"})}function se(e){return O({url:W.update,method:"post",data:e},{successMsg:"修改用户成功"})}function re(e){return O({url:W.delete,method:"post",data:e})}const ie={class:"flex justify-between"},ce=u("div",null,"组织架构",-1),ue=m("新增部门 "),pe=m("刷新 "),me=m(" 编辑 "),fe=m(" 删除 "),ye=m("取消选择"),he=m(" 新增 "),we=m(" 转移 "),be=m(" 删除 ");e("default",o({name:"SystemUser",setup(e){const[a,n]=V(),[l,o]=U(),r=s(!1),c=f({expandedKeys:[],departmentIds:[],deptTree:[]}),p=s({selectedRowKeys:[],onChange:(e,t)=>{console.log(`selectedRowKeys: ${e}`,"selectedRows: ",t),p.value.selectedRowKeys=e}}),D=y((()=>p.value.selectedRowKeys.length)),B=async(e={})=>{var t;console.log("record",e);const[a]=await l({modalProps:{title:(e.id?"编辑":"新增")+"部门",width:700,onFinish:async t=>{console.log("新增/编辑部门",t),t.id=e.id,await(e.id?F:M)(t),ae()}},formProps:{labelWidth:100,schemas:z}});null==a||a.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((null==e?void 0:e.keyPath)||[]),treeData:[{value:-1,title:"#",children:c.deptTree}]}}]),null==a||a.setFieldsValue({...e,parentId:null!==(t=e.parentId)&&void 0!==t?t:-1})},Z=async()=>{const[e]=await l({modalProps:{title:"转移部门",width:700,onFinish:async e=>{await N({departmentId:e.departmentId,userIds:p.value.selectedRowKeys.map((e=>e))})}},formProps:{labelWidth:100,schemas:Q}});null==e||e.updateSchema([{field:"departmentId",componentProps:{treeData:c.deptTree}}])},ee=async(e={})=>{var t;const[a]=await l({modalProps:{title:(e.id?"编辑":"新增")+"用户",width:700,onFinish:async t=>{console.log("新增/编辑用户",t),t.id=e.id,await(e.id?se:oe)(t),null==n||n.reload()}},formProps:{labelWidth:100,schemas:H}});if(null==a||a.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:(null===(t=X(null==e?void 0:e.departmentId,c.deptTree))||void 0===t?void 0:t.keyPath)||[],treeData:c.deptTree}}]),null==a||a.setFieldsValue(e),null!=e&&e.id){const{roles:t}=await(d={userId:e.id},O({url:W.info,method:"get",params:d}));null==a||a.setFieldsValue({roles:t})}var d},te=async e=>{await l({modalProps:{title:`修改密码(${e.username})`,width:700,onFinish:async t=>{var a;await(a={userId:e.id,password:t.password},O({url:W.password,method:"post",data:a},{successMsg:"操作成功"}))}},formProps:{labelWidth:100,schemas:J}})},ae=async()=>{r.value=!0;const e=await L().finally((()=>r.value=!1));c.deptTree=G(e),c.expandedKeys=[...c.expandedKeys,...c.deptTree.map((e=>Number(e.key)))]};ae();const ne=async e=>{Array.isArray(e)?R.confirm({title:"确定要删除所选的用户吗?",icon:t($,null,null),centered:!0,onOk:async()=>{await re({userIds:e}),ae()}}):await re({userIds:[e]}).finally(null==n?void 0:n.reload)},le=e=>{var t;c.departmentIds=e,null==n||null===(t=n.reload)||void 0===t||t.call(n)},ge=async({page:e,limit:t})=>{const a=await function(e){return O({url:W.page,method:"post",data:e})}({page:e,limit:t,departmentIds:c.departmentIds.length?c.departmentIds:void 0});return p.value.selectedRowKeys=[],a},ve=[...Y,{title:"操作",width:230,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"编辑",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>ee(e)},{label:"改密",auth:"sys.user.password",onClick:()=>te(e)},{label:"删除",auth:"sys.user.delete",popConfirm:{title:"你确定要删除吗？",onConfirm:()=>ne(e.id)}}]}];return(e,n)=>{const l=h("a-button");return i(),w(g(de),null,{"left-content":b((()=>[u("div",ie,[ce,t(g(o),{onUpdateDd:ae}),t(g(d),null,{default:b((()=>[e.$auth("sys.dept.add")?(i(),w(g(v),{key:0,placement:"top"},{title:b((()=>[ue])),default:b((()=>[t(g(x),{onClick:n[0]||(n[0]=e=>B({}))})])),_:1})):I("",!0),t(g(v),{placement:"top"},{title:b((()=>[pe])),default:b((()=>[t(g(k),{spin:r.value,onClick:ae},null,8,["spin"])])),_:1})])),_:1})]),t(g(j),{expandedKeys:g(c).expandedKeys,"onUpdate:expandedKeys":n[1]||(n[1]=e=>g(c).expandedKeys=e),"auto-expand-parent":"","tree-data":g(c).deptTree,onSelect:le},{title:b((({key:a,title:n,formData:l})=>[t(g(P),{trigger:["contextmenu"]},{overlay:b((()=>[t(g(C),null,{default:b((()=>[t(g(C).Item,{key:"1",disabled:!e.$auth("sys.dept.update"),onClick:e=>B(l)},{default:b((()=>[me,t(g(K))])),_:2},1032,["disabled","onClick"]),t(g(C).Item,{key:"2",disabled:!e.$auth("sys.dept.delete"),onClick:e=>{return n=a,void R.confirm({title:"确定要删除该部门吗?",icon:t($,null,null),centered:!0,onOk:async()=>{await A({departmentId:n}),ae()}});var n}},{default:b((()=>[fe,t(g(S))])),_:2},1032,["disabled","onClick"])])),_:2},1024)])),default:b((()=>[u("span",null,_(n),1)])),_:2},1024)])),_:1},8,["expandedKeys","tree-data"])])),"right-content":b((()=>[t(g(a),{"header-title":"用户管理","show-index":"","title-tooltip":"请不要随意删除用户，避免到影响其他用户的使用。","data-request":ge,columns:ve,scroll:{x:2e3},"row-selection":p.value},E({toolbar:b((()=>[t(l,{type:"primary",disabled:!e.$auth("sys.user.add"),onClick:n[3]||(n[3]=e=>ee({}))},{default:b((()=>[t(g(x)),he])),_:1},8,["disabled"]),t(l,{type:"success",disabled:!g(D)||!e.$auth("sys.dept.transfer"),onClick:Z},{default:b((()=>[t(g(q)),we])),_:1},8,["disabled"]),t(l,{type:"danger",disabled:!g(D)||!e.$auth("sys.user.delete"),onClick:n[4]||(n[4]=e=>ne(p.value.selectedRowKeys))},{default:b((()=>[t(g(S)),be])),_:1},8,["disabled"])])),_:2},[g(D)?{name:"title",fn:b((()=>[t(g(T),{class:"w-full",type:"info","show-icon":""},{message:b((()=>[m(" 已选 "+_(g(D))+" 项 ",1),t(l,{type:"link",onClick:n[2]||(n[2]=e=>p.value.selectedRowKeys=[])},{default:b((()=>[ye])),_:1})])),_:1})]))}:void 0]),1032,["row-selection"])])),_:1})}}}))}}}))}();
