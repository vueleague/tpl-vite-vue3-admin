var Ie=Object.defineProperty,Te=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ve=Object.getOwnPropertySymbols;var Oe=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var Ae=(r,u,a)=>u in r?Ie(r,u,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[u]=a,A=(r,u)=>{for(var a in u||(u={}))Oe.call(u,a)&&Ae(r,a,u[a]);if(ve)for(var a of ve(u))Ve.call(u,a)&&Ae(r,a,u[a]);return r},Y=(r,u)=>Te(r,Me(u));var V=(r,u,a)=>new Promise((y,p)=>{var b=w=>{try{d(a.next(w))}catch(P){p(P)}},R=w=>{try{d(a.throw(w))}catch(P){p(P)}},d=w=>w.done?y(w.value):Promise.resolve(w.value).then(b,R);d((a=a.apply(r,u)).next())});import{u as B,Q as e,bx as je,bw as Le,b as re,al as $e,m as De,bL as q,aw as we,D as G,h as se,a6 as W,bG as oe,k as _e,w as Ee,v as We,o as O,G as j,E as L,aI as Ne,aO as J,H as ce,a9 as pe,a8 as K,bM as qe,a5 as fe,bN as Ge,r as ne,I as H,ag as Se,F as Be,bO as Ke,aX as ze,f as He,t as le,n as Je,j as Re,q as ie,bP as Ye,bQ as me,bR as Ue,s as Xe,am as Qe,bS as Ze,a2 as et,e as tt,aP as de,ah as st,bT as nt}from"./vendor.0b1d9c36.js";import{A as ot,y as he,z as be,j as D,p as Q,B as at,o as rt,k as U,C as ct,_ as lt,D as Z,E as ae,F as it,G as dt,H as ut,J as ft,K as mt}from"./index.ba2a0c35.js";import{d as ke}from"./index.f26c1058.js";const ue=ot;function pt(r,u){return B(()=>{const a=e(r),{labelCol:y={},wrapperCol:p={}}=a.formItemProps||{},{labelWidth:b,disabledLabelWidth:R}=a,{labelWidth:d,labelCol:w,wrapperCol:P}=e(u);if(!d&&!b&&!w||R)return y.style={textAlign:"left"},{labelCol:y,wrapperCol:p};let h=b||d;const x=A(A({},w),y),T=A(A({},P),p);return h&&(h=he(h)?`${h}px`:h),{labelCol:A({style:{width:h}},x),wrapperCol:A({style:{width:`calc(100% - ${h})`}},T)}})}function Fe(r,u=""){const{t:a}=be();if(r.includes("Input")||r.includes("Complete"))return`${a("common.inputText")}${u}`;const y=["Select","Cascader","Checkbox","CheckboxGroup","Switch","TreeSelect"];return r.includes("Picker")||y.includes(r)?`${a("common.chooseText")}${u}`:""}const ht=["DatePicker","MonthPicker","WeekPicker","TimePicker"];function bt(){return[...ht,"RangePicker"]}function yt(r,u){return r&&["Input","InputPassword","InputSearch","InputTextArea"].includes(r)&&u&&he(u)?`${u}`:u}const gt=bt(),xe=Symbol("schema-form");function vt(r){return V(this,null,function*(){Le(xe,r)})}function Ce(){return je(xe)}const At={name:"SchemaFormItem"};var wt=re(Y(A({},At),{props:{formModel:{type:Object,default:()=>({})},schema:{type:Object,default:()=>({})},setFormModel:{type:Function,default:null},tableInstance:{type:Object},setItemRef:{type:Function,default:()=>({})}},emits:["update:formModel"],setup(r,{emit:u}){const a=r,y=Ce(),{formPropsRef:p}=y,b=$e(a,"formModel",u),{t:R}=be(),{schema:d}=De(a),w=pt(d,p),P=B(()=>{const{component:s,componentProps:o}=d.value;return!q(o)&&(o==null?void 0:o.vModelKey)?o.vModelKey:D(s)&&["Switch","Checkbox"].includes(s)?"checked":"value"}),h=B(()=>{const{formModel:s,schema:o,tableInstance:t}=a,{mergeDynamicData:n}=e(p);return{field:o.field,formInstance:y,tableInstance:t,formModel:s,values:A(A({},n),s),schema:o}}),x=B(()=>{const{vShow:s,vIf:o,isAdvanced:t=!1}=e(d),{showAdvancedButton:n}=e(p),f=n&&Q(t)?t:!0;let l=!0,i=!0;return Q(s)&&(l=s),Q(o)&&(i=o),q(s)&&(l=s(e(h))),q(o)&&(i=o(e(h))),l=l&&f,{isShow:l,isIfShow:i}}),T=B(()=>{const{disabled:s}=e(p),{dynamicDisabled:o}=a.schema,{disabled:t=!1}=e(g);let n=!!s||t;return Q(o)&&(n=o),q(o)&&(n=o(e(h))),n}),k=(s,o=e(h))=>{if(D(s))return G(Be,null,[s]);if(we(s))return s;if(q(s))return k(s(o));if(U(s)){const t=Object.keys(s);return t.some(n=>n.startsWith("_")||["setup","render"].includes(n))?s:t.reduce((n,f)=>(n[f]=(...l)=>k(s[f],l),n),{})}return s},c=B(()=>{var o;const s=a.schema.component;return D(s)&&(o=at[s])!=null?o:k(s)}),m=B(()=>{var o;const s=(o=a.schema.componentSlots)!=null?o:{};return D(s)||we(s)?{default:(...t)=>k(s,t)}:k(s)}),g=B(()=>{var f,l;const{schema:s}=a;let{componentProps:o={},component:t,label:n=""}=s;return q(o)&&(o=(f=o(e(h)))!=null?f:{}),t!=="RangePicker"&&D(t)&&((l=o.placeholder)!=null||(o.placeholder=Fe(t,n))),s.component==="Divider"&&(o=Object.assign({type:"horizontal"},o,{orientation:"left",plain:!0})),s.field,o}),F=B(()=>{var o;const s=((o=a.schema)==null?void 0:o.componentProps)||{};return Object.keys(s).reduce((t,n)=>{if(/on([A-Z])/.test(n)){const f=n.replace(/on([A-Z])/,"$1").toLocaleLowerCase();t[f]=s[n]}return t},{})}),S=B(()=>{const{label:s,helpMessage:o,helpComponentProps:t,subLabel:n}=a.schema,f=n?G("span",null,[s,se(" "),G("span",{class:"text-secondary"},[n])]):k(s),l=q(o)?o(e(h)):o;return!l||Array.isArray(l)&&l.length===0?f:G("span",null,[f,G(rt,W({placement:"top",class:"mx-1",text:l},t),null)])});function v(s,o,t){["DatePicker","MonthPicker","WeekPicker","TimePicker"].includes(o)?s.type=t?"string":"object":["RangePicker","Upload","CheckboxGroup","TimePicker"].includes(o)?s.type="array":["InputNumber"].includes(o)&&(s.type="number")}const C=B(()=>{var ge;const{rules:s=[],component:o,rulesMessageJoinLabel:t,label:n,dynamicRules:f,required:l}=a.schema;if(q(f))return f(e(h));let i=oe(s);const{rulesMessageJoinLabel:I}=e(p),_=Reflect.has(e(p),"rulesMessageJoinLabel")?t:I,ee=D(o)?`${Fe(o,n)}${_?n:""}`:void 0;function N($,M){const te=$.message||ee;return M===void 0||ct(M)||Array.isArray(M)&&M.length===0||typeof M=="string"&&M.trim()===""||typeof M=="object"&&Reflect.has(M,"checked")&&Reflect.has(M,"halfChecked")&&Array.isArray(M.checked)&&Array.isArray(M.halfChecked)&&M.checked.length===0&&M.halfChecked.length===0?Promise.reject(te):Promise.resolve()}const E=q(l)?l(e(h)):l;(!i||i.length===0)&&E&&(i=[{required:E,validator:N}]);const ye=i.findIndex($=>Reflect.has($,"required")&&!Reflect.has($,"validator"));if(ye!==-1){const $=i[ye];if(o&&D(o)){Reflect.has($,"type")||($.type=o==="InputNumber"?"number":"string"),$.message=$.message||ee,(o.includes("Input")||o.includes("Textarea"))&&($.whitespace=!0);const M=(ge=e(g))==null?void 0:ge.valueFormat;v($,o,M)}}const X=i.findIndex($=>$.max);return X!==-1&&!i[X].validator&&(i[X].message=i[X].message||R("component.form.maxTip",[i[X].max])),i});return _e(()=>V(this,null,function*(){var s,o;if((s=g.value)!=null&&s.request){const t=g.value,{componentProps:n,component:f}=d.value;d.value.loading=!0,d.value.field==="field35"&&p.value;try{const l=yield(o=g.value)==null?void 0:o.request(e(h));["Select","RadioGroup","CheckBoxGroup"].some(i=>i===f)?t.options=l:["TreeSelect","Tree"].some(i=>i===f)&&(t.treeData=l),n&&(n.requestResult=l)}finally{d.value.loading=!1}}})),(s,o)=>e(x).isIfShow?Ee((O(),j(e(Se),J(W({key:0},e(d).colProps)),{default:L(()=>[e(d).component==="Divider"?(O(),j(e(Ne),J(W({key:0},e(g))),{default:L(()=>[(O(),j(ce(e(S))))]),_:1},16)):(O(),j(e(pe).Item,W({key:1},A({},e(d).formItemProps),{label:e(S),name:e(d).field,"label-col":e(w).labelCol,"wrapper-col":e(w).wrapperCol,rules:e(C)}),{default:L(()=>[e(d).slot?K(s.$slots,e(d).slot,J(W({key:0},e(h)))):e(c)?(O(),j(ce(e(c)),W({key:1,ref:r.setItemRef,key:e(d).field},e(g),{[e(P)]:e(b)[e(d).field],["onUpdate:"+e(P)]:o[0]||(o[0]=t=>e(b)[e(d).field]=t),"allow-clear":!0,disabled:e(T)},qe(e(F))),fe({_:2},[Object.is(e(d).loading,!0)?{name:"notFoundContent",fn:L(()=>[G(e(Ge),{size:"small"})])}:void 0,ne(e(m),(t,n)=>({name:n,fn:L(f=>{var l;return[(O(),j(ce((l=t==null?void 0:t(Y(A({},e(h)),{slotData:f})))!=null?l:t),{key:n}))]})}))]),1040,["disabled"])):H("",!0)]),_:3},16,["label","name","label-col","wrapper-col","rules"]))]),_:3},16)),[[We,e(x).isShow]]):H("",!0)}}));const Rt=re({props:{expand:{type:Boolean}},setup(r){const u=r;Ke(y=>({"3cc09834":e(a)}));const a=B(()=>`${u.expand?0:.5}turn`);return(y,p)=>(O(),j(e(ze),{class:"collapse-icon"}))}});var Ft=lt(Rt,[["__scopeId","data-v-623bf38a"]]);const Pt={name:"FormAction",inheritAttrs:!1},St=re(Y(A({},Pt),{props:{showActionButtonGroup:{type:Boolean,default:!0},showResetButton:{type:Boolean,default:!0},showSubmitButton:{type:Boolean,default:!0},showAdvancedButton:{type:Boolean,default:!0},resetButtonOptions:{type:Object,default:()=>({})},submitButtonOptions:{type:Object,default:()=>({})},actionColOptions:{type:Object,default:()=>({})},actionSpan:{type:Number,default:6},isAdvanced:Boolean,hideAdvanceBtn:Boolean},emits:["toggle-advanced"],setup(r,{emit:u}){const a=r,{t:y}=be(),{resetFields:p,submit:b}=Ce(),R=B(()=>{const{showAdvancedButton:h,actionSpan:x,actionColOptions:T}=a,k=24-x,c=h?{span:k<6?24:k}:{};return A(A({style:{textAlign:"right"},span:h?6:4},c),T)}),d=B(()=>Object.assign({text:y("common.resetText")},a.resetButtonOptions)),w=B(()=>Object.assign({text:y("common.queryText")},a.submitButtonOptions));function P(){u("toggle-advanced",a.isAdvanced)}return(h,x)=>r.showActionButtonGroup?(O(),j(e(Se),J(W({key:0},e(R))),{default:L(()=>[He("div",{style:Je([{width:"100%"},{textAlign:e(R).style.textAlign}])},[G(e(pe).Item,null,{default:L(()=>[K(h.$slots,"resetBefore"),r.showResetButton?(O(),j(e(ue),W({key:0,type:"default",class:"mr-2"},e(d),{onClick:e(p)}),{default:L(()=>[se(le(e(d).text),1)]),_:1},16,["onClick"])):H("",!0),K(h.$slots,"submitBefore"),r.showSubmitButton?(O(),j(e(ue),W({key:1,type:"primary",class:"mr-2"},e(w),{onClick:e(b)}),{default:L(()=>[se(le(e(w).text),1)]),_:1},16,["onClick"])):H("",!0),K(h.$slots,"advanceBefore"),r.showAdvancedButton&&!r.hideAdvanceBtn?(O(),j(e(ue),{key:2,type:"link",size:"small",onClick:P},{default:L(()=>[se(le(r.isAdvanced?e(y)("component.form.putAway"):e(y)("component.form.unfold"))+" ",1),G(e(Ft),{class:"ml-1",expand:!r.isAdvanced},null,8,["expand"])]),_:1})):H("",!0),K(h.$slots,"advanceAfter")]),_:3})],4)]),_:3},16)):H("",!0)}})),Bt=({props:r,attrs:u})=>{const a=Re(oe(r)),y=ie(A({},r.initialValues)),p=ie(A({},r.initialValues)),b=Re(),R=A({},r.initialValues),d={},w=ie({isAdvanced:!0,hideAdvanceBtn:!1,isLoad:!1,actionSpan:6}),P=B(()=>A(A({},u),a.value)),h=B(()=>{const{baseRowStyle:T={},rowProps:k}=e(P);return A({style:T},k)}),x=B(()=>A(A({},P.value),w));return{formModel:y,defaultFormValues:p,schemaFormRef:b,formPropsRef:a,cacheFormModel:R,compRefs:d,getFormProps:P,advanceState:w,getRowConfig:h,getFormActionBindProps:x,formSchemasRef:B(()=>e(a).schemas||[])}};function kt(r){const{emit:u,formPropsRef:a,formSchemasRef:y,formModel:p,cacheFormModel:b,getFormProps:R,schemaFormRef:d,defaultFormValues:w,handleFormValues:P}=r;function h(){return e(d)?P(Ye(e(p))):{}}function x(t){var n;return(n=e(a).schemas)==null?void 0:n.some(f=>f.field===t&&D(f.component)?gt.includes(f.component):!1)}function T(t){return V(this,null,function*(){const n=e(y),f=n.map(i=>i.field).filter(Boolean);Object.assign(b,t);const l=[];Object.keys(t).forEach(i=>{const I=n.find(N=>N.field===i);let _=t[i];const ee=Reflect.has(t,i);if(D(I==null?void 0:I.component)&&(_=yt(I==null?void 0:I.component,_)),ee&&f.includes(i)){if(x(i))if(Array.isArray(_)){const N=[];for(const E of _)N.push(E?me(E):null);p[i]=N}else{const{componentProps:N}=I||{};let E=N;Z(N)&&(E=E({formPropsRef:a,formModel:p})),p[i]=_?E!=null&&E.valueFormat?_:me(_):null}else p[i]=_;l.push(i)}}),S(l)})}function k(t){return V(this,null,function*(){let n=[];U(t)&&n.push(t),ae(t)&&(n=[...t]),e(a).schemas=n})}function c(t,n,f=!1){return V(this,null,function*(){const l=oe(e(y)),i=l.findIndex(I=>I.field===n);if(!n||i===-1||f){f?l.unshift(t):l.push(t),p[t.field]=t.defaultValue,a.value.schemas=l;return}i!==-1&&l.splice(i+1,0,t),p[t.field]=t.defaultValue,a.value.schemas=l})}function m(t){return V(this,null,function*(){const n=oe(e(y));if(!t)return;let f=D(t)?[t]:t;D(t)&&(f=[t]);for(const l of f)if(D(l)){const i=n.findIndex(I=>I.field===l);i!==-1&&(Reflect.deleteProperty(p,l),n.splice(i,1))}a.value.schemas=n})}function g(t){return V(this,null,function*(){let n=[];if(U(t)&&n.push(t),ae(t)&&(n=[...t]),!n.every(i=>i.component==="Divider"||Reflect.has(i,"field")&&i.field)){console.error("All children of the form Schema array that need to be updated must contain the `field` field");return}const l=[];n.forEach(i=>{e(y).forEach(I=>{if(I.field===i.field){const _=ke(I,i);l.push(_)}else l.push(I)})}),e(a).schemas=Ue(l,"field")})}function F(){return V(this,null,function*(){const{resetFunc:t,submitOnReset:n}=e(R);t&&Z(t)&&(yield t()),Object.keys(p).forEach(f=>{p[f]=w[f]}),u("reset",p),n&&o(),setTimeout(C)})}function S(t){return V(this,null,function*(){var n;return(n=d.value)==null?void 0:n.validateFields(t)})}function v(t){return V(this,null,function*(){var n;return yield(n=d.value)==null?void 0:n.validate(t)})}function C(t){return V(this,null,function*(){var n;yield(n=d.value)==null?void 0:n.clearValidate(t)})}function s(t,n){return V(this,null,function*(){var f;yield(f=d.value)==null?void 0:f.scrollToField(t,n)})}function o(t){return V(this,null,function*(){t&&t.preventDefault();const{submitFunc:n}=e(R);if(n&&Z(n)){yield n();return}if(!!e(d))try{const l=yield v(),i=P(l);u("submit",i)}catch(l){return Promise.reject(l)}})}return{submit:o,clearValidate:C,validate:v,validateFields:S,getFieldsValue:h,updateSchema:g,resetSchema:k,appendSchemaByField:c,removeSchemaByFiled:m,resetFields:F,setFieldsValue:T,scrollToField:s}}const Pe=me,xt=r=>{const{compRefs:u,formModel:a,formPropsRef:y,cacheFormModel:p,defaultFormValues:b,schemaFormRef:R,getFormProps:d}=r,w=c=>m=>{m&&(u[c.field]=m)},P=(c,m)=>{var F;a[c]=m,p[c]=m;const{validateTrigger:g}=e(d);(!g||g==="change")&&((F=R.value)==null||F.validateFields([c]))},h=c=>{y.value=ke(e(y)||{},c)};function x(c){var g,F;if(!U(c))return{};const m={};for(const S of Object.entries(c)){let[,v]=S;const[C]=S;if(!C||ae(v)&&v.length===0||Z(v))continue;const s=e(d).transformDateFunc;U(v)&&(v=s==null?void 0:s(v)),ae(v)&&((g=v[0])==null?void 0:g.format)&&((F=v[1])==null?void 0:F.format)&&(v=v.map(o=>s==null?void 0:s(o))),D(v)&&(v=v.trim()),Xe(m,C,v)}return T(m)}function T(c){const m=e(d).fieldMapToTime;if(!m||!Array.isArray(m))return c;for(const[g,[F,S],v="YYYY-MM-DD"]of m){if(!g||!F||!S||!c[g])continue;const[C,s]=c[g];c[F]=Pe(C).format(v),c[S]=Pe(s).format(v),Reflect.deleteProperty(c,g)}return c}return{setItemRef:w,initFormValues:()=>{var c;(c=e(y).schemas)==null||c.forEach(m=>{const{defaultValue:g}=m;it(g)||(a[m.field]=g,b[m.field]=g,p[m.field]=g)})},setFormModel:P,setSchemaFormProps:h,handleFormValues:x}};let Ct,It,Tt;function Mt(){return{screenRef:B(()=>e(Ct)),widthRef:It,screenEnum:dt,realWidthRef:Tt}}const z=24,Ot=({instance:r,emit:u})=>{const{realWidthRef:a,screenEnum:y,screenRef:p}=Mt(),{advanceState:b,getFormProps:R,formSchemasRef:d,formModel:w,defaultFormValues:P}=r,h=B(()=>{if(!b.isAdvanced)return 0;const c=e(R).emptySpan||0;if(he(c))return c;if(U(c)){const{span:m=0}=c,g=e(p);return c[g.toLowerCase()]||m||0}return 0});Qe([()=>e(d),()=>b.isAdvanced,()=>e(a)],()=>{const{showAdvancedButton:c}=e(R);c&&T()},{immediate:!0});function x(c,m=0,g=!1){const F=e(a),S=parseInt(c.md)||parseInt(c.xs)||parseInt(c.sm)||c.span||z,v=parseInt(c.lg)||S,C=parseInt(c.xl)||v,s=parseInt(c.xxl)||C;return F<=y.LG?m+=S:F<y.XL?m+=v:F<y.XXL?m+=C:m+=s,g?(b.hideAdvanceBtn=!1,m<=z*2?(b.hideAdvanceBtn=!0,b.isAdvanced=!0):m>z*2&&m<=z*(e(R).autoAdvancedLine||3)?b.hideAdvanceBtn=!1:b.isLoad||(b.isLoad=!0,b.isAdvanced=!b.isAdvanced),{isAdvanced:b.isAdvanced,itemColSum:m}):m>z*(e(R).alwaysShowLines||1)?{isAdvanced:b.isAdvanced,itemColSum:m}:{isAdvanced:!0,itemColSum:m}}function T(){let c=0,m=0;const{baseColProps:g={}}=e(R);for(const F of e(d)){const{vShow:S,colProps:v}=F;let C=!0;if(Q(S)&&(C=S),Z(S)&&(C=S({schema:F,formModel:w,field:F.field,formInstance:r,values:A(A({},e(P)),w)})),C&&(v||g)){const{itemColSum:s,isAdvanced:o}=x(A(A({},g),v),c);c=s||0,o&&(m=c),F.isAdvanced=o}}b.actionSpan=m%z+e(h),x(e(R).actionColOptions||{span:z},c,!0),u("advanced-change")}function k(){b.isAdvanced=!b.isAdvanced}return{handleToggleAdvanced:k}},Vt={name:"SchemaForm"},_t=re(Y(A({},Vt),{props:ut,emits:ft,setup(r,{expose:u,emit:a}){const y=r,p=Ze(),b=Bt({props:y,attrs:p}),{formModel:R,getRowConfig:d,schemaFormRef:w,getFormProps:P,getFormActionBindProps:h,formSchemasRef:x}=b,T=xt(A({},b)),{initFormValues:k,handleFormValues:c,setFormModel:m,setItemRef:g,setSchemaFormProps:F}=T;k();const S=kt(Y(A({},b),{emit:a,handleFormValues:c}));et(()=>F(y));const v=A(A(A({},b),S),T),{handleToggleAdvanced:C}=Ot({instance:v,emit:a});return a("register",v),vt(v),u(v),(s,o)=>(O(),j(e(pe),W({ref_key:"schemaFormRef",ref:w},e(nt)(e(P),e(mt)),{model:e(R)}),{default:L(()=>[G(e(st),J(de(e(d))),{default:L(()=>[K(s.$slots,"formHeader"),(O(!0),tt(Be,null,ne(e(x),t=>(O(),j(wt,{key:t.field,schema:t,"set-form-model":e(m),"form-model":e(R),"table-instance":s.tableInstance,"set-item-ref":e(g)(t)},fe({_:2},[ne(Object.keys(s.$slots),n=>({name:n,fn:L(f=>[K(s.$slots,n,J(de(f||{})))])}))]),1032,["schema","set-form-model","form-model","table-instance","set-item-ref"]))),128)),s.showActionButtonGroup?(O(),j(St,W({key:0},e(h),{onToggleAdvanced:e(C)}),fe({_:2},[ne(["resetBefore","submitBefore","advanceBefore","advanceAfter"],t=>({name:t,fn:L(n=>[K(s.$slots,t,J(de(n||{})))])}))]),1040,["onToggleAdvanced"])):H("",!0),K(s.$slots,"formFooter")]),_:3},16)]),_:3},16,["model"]))}}));export{_t as _,Pe as d};
