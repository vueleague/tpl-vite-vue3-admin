var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var B=(t,s,a)=>s in t?ee(t,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[s]=a,E=(t,s)=>{for(var a in s||(s={}))se.call(s,a)&&B(t,a,s[a]);if(F)for(var a of F(s))ne.call(s,a)&&B(t,a,s[a]);return t},P=(t,s)=>te(t,ae(s));var c=(t,s,a)=>new Promise((y,_)=>{var b=m=>{try{r(a.next(m))}catch(g){_(g)}},i=m=>{try{r(a.throw(m))}catch(g){_(g)}},r=m=>m.done?y(m.value):Promise.resolve(m.value).then(b,i);r((a=a.apply(t,s)).next())});import{D as n,X as le,bo as K,aw as oe,ap as R,b as W,j as x,au as de,o as S,e as ue,f as w,a8 as T,h as f,q as ie,u as re,C as pe,G as A,E as u,Q as l,aJ as M,bp as U,I as ce,bq as me,aT as he,ac as k,br as fe,bs as q,t as N,aC as ye,a5 as we,bt as be,bu as _e,M as L,bv as O}from"./vendor.0b1d9c36.js";/* empty css              */import{g as ge,u as ve,c as Ie,t as Ce,d as Ee,a as Pe}from"./index.f5666980.js";import{u as ke}from"./dynamic-table.bceae78c.js";import{i as I,s as C}from"./index.ba2a0c35.js";import{u as xe}from"./useFormModal.c00c4eeb.js";import{f as Se,a as De}from"./utils.1ab06744.js";import"./schema-form.a98a8267.js";import"./index.f26c1058.js";const $e=[{field:"name",component:"Input",label:"\u90E8\u95E8\u540D\u79F0",rules:[{required:!0,type:"string"}]},{field:"parentId",component:"TreeSelect",label:"\u4E0A\u7EA7\u90E8\u95E8",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"orderNum",component:"InputNumber",label:"\u6392\u5E8F\u53F7",defaultValue:255,componentProps:{style:{width:"100%"}}}],Fe=[{field:"departmentId",component:"TreeSelect",label:"\u6240\u5C5E\u90E8\u95E8",componentProps:{getPopupContainer:()=>document.body},rules:[{required:!0,type:"number"}]},{field:"roles",component:"Select",label:"\u6240\u5C5E\u89D2\u8272",rules:[{required:!0,type:"array"}],componentProps:{mode:"multiple",request:()=>c(void 0,null,function*(){return(yield ge()).map(s=>({label:s.name,value:s.id}))})}},{field:"username",component:"Input",label:"\u7528\u6237\u540D",rules:[{required:!0}]},{field:"name",component:"Input",label:"\u59D3\u540D",colProps:{span:12},rules:[{required:!0}]},{field:"nickName",component:"Input",label:"\u5462\u79F0",colProps:{span:12}},{field:"email",component:"Input",label:"\u90AE\u7BB1",colProps:{span:12}},{field:"phone",component:"Input",label:"\u624B\u673A",colProps:{span:12}},{field:"remark",component:"InputTextArea",label:"\u5907\u6CE8"},{field:"status",component:"RadioGroup",label:"\u72B6\u6001",defaultValue:1,componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}}],Be=[{field:"password",component:"Input",label:"\u65B0\u5BC6\u7801",rules:[{required:!0,type:"string"}]}],Ke=[{field:"departmentId",component:"TreeSelect",label:"\u8F6C\u79FB\u81F3",rules:[{required:!0,type:"number"}]}];function V(t){return typeof t=="function"||Object.prototype.toString.call(t)==="[object Object]"&&!oe(t)}const Te=[{title:"\u5934\u50CF",width:80,dataIndex:"headImg",hideInSearch:!0,bodyCell:({record:t})=>n(le,{src:t.headImg},null)},{title:"\u59D3\u540D",width:120,dataIndex:"name",align:"center"},{title:"\u7528\u6237\u540D",width:120,align:"center",dataIndex:"username"},{title:"\u6240\u5728\u90E8\u95E8",dataIndex:"departmentName",hideInSearch:!0,align:"center",width:180},{title:"\u6240\u5C5E\u89D2\u8272",dataIndex:"roleNames",align:"center",hideInSearch:!0,width:220,customRender:({text:t})=>{let s;return n(R,null,V(s=t.map(a=>n(K,{color:"success",key:a},V(a)?a:{default:()=>[a]})))?s:{default:()=>[s]})}},{title:"\u5462\u79F0",width:120,align:"center",dataIndex:"nickName"},{title:"\u90AE\u7BB1",width:120,align:"center",dataIndex:"email"},{title:"\u624B\u673A",width:120,align:"center",dataIndex:"phone"},{title:"\u5907\u6CE8",width:120,align:"center",dataIndex:"remark"},{title:"\u72B6\u6001",dataIndex:"status",width:100,formItemProps:{component:"Select",componentProps:{options:[{label:"\u542F\u7528",value:1},{label:"\u7981\u7528",value:0}]}},bodyCell:({record:t})=>{const s=t.status===1;return n(K,{color:s?"success":"red"},{default:()=>[s?"\u542F\u7528":"\u7981\u7528"]})}},{title:"\u521B\u5EFA\u65F6\u95F4",dataIndex:"createdAt",width:120},{title:"\u4FEE\u6539\u65F6\u95F4",dataIndex:"updatedAt",width:120}];const Ae={class:"split-wrapper"},Me={class:"left-content"},Ue=f(" \u53F3\u8FB9\u5185\u5BB9\u533A "),qe=w("i",null,null,-1),Ne=w("i",null,null,-1),Le=[qe,Ne],Oe={class:"right-content"},Ve=f(" \u53F3\u8FB9\u5185\u5BB9\u533A "),je=W({setup(t){const s=x();let a,y;const _=de(function(r){s.value&&(s.value.style.width=`${y+r.clientX-a}px`)},20),b=()=>{document.documentElement.style.userSelect="unset",document.documentElement.removeEventListener("mousemove",_),document.documentElement.removeEventListener("mouseup",b)},i=r=>{a=r.clientX,s.value&&(y=parseInt(window.getComputedStyle(s.value).width,10)),document.documentElement.style.userSelect="none",document.documentElement.addEventListener("mousemove",_),document.documentElement.addEventListener("mouseup",b)};return(r,m)=>(S(),ue("div",Ae,[w("div",{ref_key:"scalable",ref:s,class:"scalable"},[w("div",Me,[T(r.$slots,"left-content",{},()=>[Ue])]),w("div",{ref:"separator",class:"separator",onMousedown:i},Le,544)],512),w("div",Oe,[T(r.$slots,"right-content",{},()=>[Ve])])]))}});var Re=je;function We(t){return I({url:C.page,method:"post",data:t})}function Xe(t){return I({url:C.add,method:"post",data:t},{successMsg:"\u521B\u5EFA\u7528\u6237\u6210\u529F"})}function Ge(t){return I({url:C.info,method:"get",params:t})}function Je(t){return I({url:C.update,method:"post",data:t},{successMsg:"\u4FEE\u6539\u7528\u6237\u6210\u529F"})}function Qe(t){return I({url:C.password,method:"post",data:t},{successMsg:"\u64CD\u4F5C\u6210\u529F"})}function j(t){return I({url:C.delete,method:"post",data:t})}const ze={class:"flex justify-between"},He=w("div",null,"\u7EC4\u7EC7\u67B6\u6784",-1),Ye=f("\u65B0\u589E\u90E8\u95E8 "),Ze=f("\u5237\u65B0 "),et=f(" \u7F16\u8F91 "),tt=f(" \u5220\u9664 "),at=f("\u53D6\u6D88\u9009\u62E9"),st=f(" \u65B0\u589E "),nt=f(" \u8F6C\u79FB "),lt=f(" \u5220\u9664 "),ot={name:"SystemUser"};var wt=W(P(E({},ot),{setup(t){const[s,a]=ke(),[y,_]=xe(),b=x(!1),i=ie({expandedKeys:[],departmentIds:[],deptTree:[]}),r=x({selectedRowKeys:[],onChange:(e,o)=>{`${e}`,r.value.selectedRowKeys=e}}),m=re(()=>r.value.selectedRowKeys.length),g=(...o)=>c(this,[...o],function*(e={}){var p;const[d]=yield y({modalProps:{title:`${e.id?"\u7F16\u8F91":"\u65B0\u589E"}\u90E8\u95E8`,width:700,onFinish:h=>c(this,null,function*(){h.id=e.id,yield(e.id?ve:Ie)(h),v()})},formProps:{labelWidth:100,schemas:$e}});d==null||d.updateSchema([{field:"parentId",componentProps:{treeDefaultExpandedKeys:[-1].concat((e==null?void 0:e.keyPath)||[]),treeData:[{value:-1,title:"#",children:i.deptTree}]}}]),d==null||d.setFieldsValue(P(E({},e),{parentId:(p=e.parentId)!=null?p:-1}))}),X=()=>c(this,null,function*(){const[e]=yield y({modalProps:{title:"\u8F6C\u79FB\u90E8\u95E8",width:700,onFinish:o=>c(this,null,function*(){yield Ce({departmentId:o.departmentId,userIds:r.value.selectedRowKeys.map(d=>d)})})},formProps:{labelWidth:100,schemas:Ke}});e==null||e.updateSchema([{field:"departmentId",componentProps:{treeData:i.deptTree}}])}),D=(...o)=>c(this,[...o],function*(e={}){var p;const[d]=yield y({modalProps:{title:`${e.id?"\u7F16\u8F91":"\u65B0\u589E"}\u7528\u6237`,width:700,onFinish:h=>c(this,null,function*(){h.id=e.id,yield(e.id?Je:Xe)(h),a==null||a.reload()})},formProps:{labelWidth:100,schemas:Fe}});if(d==null||d.updateSchema([{field:"departmentId",componentProps:{treeDefaultExpandedKeys:((p=Se(e==null?void 0:e.departmentId,i.deptTree))==null?void 0:p.keyPath)||[],treeData:i.deptTree}}]),d==null||d.setFieldsValue(e),e!=null&&e.id){const{roles:h}=yield Ge({userId:e.id});d==null||d.setFieldsValue({roles:h})}}),G=e=>c(this,null,function*(){yield y({modalProps:{title:`\u4FEE\u6539\u5BC6\u7801(${e.username})`,width:700,onFinish:o=>c(this,null,function*(){yield Qe({userId:e.id,password:o.password})})},formProps:{labelWidth:100,schemas:Be}})}),J=e=>{L.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u90E8\u95E8\u5417?",icon:n(O,null,null),centered:!0,onOk:()=>c(this,null,function*(){yield Ee({departmentId:e}),v()})})},v=()=>c(this,null,function*(){b.value=!0;const e=yield Pe().finally(()=>b.value=!1);i.deptTree=De(e),i.expandedKeys=[...i.expandedKeys,...i.deptTree.map(o=>Number(o.key))]});v();const $=e=>c(this,null,function*(){Array.isArray(e)?L.confirm({title:"\u786E\u5B9A\u8981\u5220\u9664\u6240\u9009\u7684\u7528\u6237\u5417?",icon:n(O,null,null),centered:!0,onOk:()=>c(this,null,function*(){yield j({userIds:e}),v()})}):yield j({userIds:[e]}).finally(a==null?void 0:a.reload)}),Q=e=>{var o;i.departmentIds=e,(o=a==null?void 0:a.reload)==null||o.call(a)},z=d=>c(this,[d],function*({page:e,limit:o}){const p=yield We({page:e,limit:o,departmentIds:i.departmentIds.length?i.departmentIds:void 0});return r.value.selectedRowKeys=[],p}),H=[...Te,{title:"\u64CD\u4F5C",width:230,dataIndex:"$action",align:"center",fixed:"right",actions:({record:e})=>[{label:"\u7F16\u8F91",auth:{perm:"sys.user.update",effect:"disable"},onClick:()=>D(e)},{label:"\u6539\u5BC6",auth:"sys.user.password",onClick:()=>G(e)},{label:"\u5220\u9664",auth:"sys.user.delete",popConfirm:{title:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u5417\uFF1F",onConfirm:()=>$(e.id)}}]}];return(e,o)=>{const d=pe("a-button");return S(),A(l(Re),null,{"left-content":u(()=>[w("div",ze,[He,n(l(_),{onUpdateDd:v}),n(l(R),null,{default:u(()=>[e.$auth("sys.dept.add")?(S(),A(l(M),{key:0,placement:"top"},{title:u(()=>[Ye]),default:u(()=>[n(l(U),{onClick:o[0]||(o[0]=p=>g({}))})]),_:1})):ce("",!0),n(l(M),{placement:"top"},{title:u(()=>[Ze]),default:u(()=>[n(l(me),{spin:b.value,onClick:v},null,8,["spin"])]),_:1})]),_:1})]),n(l(ye),{expandedKeys:l(i).expandedKeys,"onUpdate:expandedKeys":o[1]||(o[1]=p=>l(i).expandedKeys=p),"auto-expand-parent":"","tree-data":l(i).deptTree,onSelect:Q},{title:u(({key:p,title:h,formData:Y})=>[n(l(he),{trigger:["contextmenu"]},{overlay:u(()=>[n(l(k),null,{default:u(()=>[n(l(k).Item,{key:"1",disabled:!e.$auth("sys.dept.update"),onClick:Z=>g(Y)},{default:u(()=>[et,n(l(fe))]),_:2},1032,["disabled","onClick"]),n(l(k).Item,{key:"2",disabled:!e.$auth("sys.dept.delete"),onClick:Z=>J(p)},{default:u(()=>[tt,n(l(q))]),_:2},1032,["disabled","onClick"])]),_:2},1024)]),default:u(()=>[w("span",null,N(h),1)]),_:2},1024)]),_:1},8,["expandedKeys","tree-data"])]),"right-content":u(()=>[n(l(s),{"header-title":"\u7528\u6237\u7BA1\u7406","show-index":"","title-tooltip":"\u8BF7\u4E0D\u8981\u968F\u610F\u5220\u9664\u7528\u6237\uFF0C\u907F\u514D\u5230\u5F71\u54CD\u5176\u4ED6\u7528\u6237\u7684\u4F7F\u7528\u3002","data-request":z,columns:H,scroll:{x:2e3},"row-selection":r.value},we({toolbar:u(()=>[n(d,{type:"primary",disabled:!e.$auth("sys.user.add"),onClick:o[3]||(o[3]=p=>D({}))},{default:u(()=>[n(l(U)),st]),_:1},8,["disabled"]),n(d,{type:"success",disabled:!l(m)||!e.$auth("sys.dept.transfer"),onClick:X},{default:u(()=>[n(l(_e)),nt]),_:1},8,["disabled"]),n(d,{type:"danger",disabled:!l(m)||!e.$auth("sys.user.delete"),onClick:o[4]||(o[4]=p=>$(r.value.selectedRowKeys))},{default:u(()=>[n(l(q)),lt]),_:1},8,["disabled"])]),_:2},[l(m)?{name:"title",fn:u(()=>[n(l(be),{class:"w-full",type:"info","show-icon":""},{message:u(()=>[f(" \u5DF2\u9009 "+N(l(m))+" \u9879 ",1),n(d,{type:"link",onClick:o[2]||(o[2]=p=>r.value.selectedRowKeys=[])},{default:u(()=>[at]),_:1})]),_:1})])}:void 0]),1032,["row-selection"])]),_:1})}}}));export{wt as default};
